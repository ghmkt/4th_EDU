# 제출 시 제목은 Session05 이름으로 해주세요!
# kNN&Clustering의 퀘스트 코드를 아래에 기입해주세요.

import numpy as np
import pandas as pd
from os import listdir
import matplotlib.pyplot as plt
import sklearn
from sklearn.neighbors import KNeighborsClassifier
from sklearn.model_selection import train_test_split

path = "D:\\Growth Hackers\\Session05Quest\\Data\\trainingDigits\\"
training_file_list = listdir( path )

path2 = "D:\\Growth Hackers\\Session05Quest\\Data\\testDigits\\"
test_file_list = listdir(path2)
#print(training_file_list)

def xy_value(txt_file_name):
    r = open('D:\\Growth Hackers\\Session05Quest\\Data\\trainingDigits\\{}'.format(txt_file_name), mode='rt', encoding='utf-8')
    tmp = r.read()
    r.close()
    return (np.array(list(tmp.replace('\n', ''))), int(txt_file_name[0]))

x = []
y = []

for file in training_file_list:
    x.append(xy_value(file)[0])
    y.append(xy_value(file)[1])
X_train, X_test, Y_train, Y_test = train_test_split(x, y, test_size = 0.33, random_state = 5)

accuracy_table = pd.DataFrame(columns = ['k-value',
                                    'accuracy'])   
for k in range(1,10):
    knn = KNeighborsClassifier(n_neighbors=k)
    knn.fit(X_train, Y_train)
    test_pred = knn.predict(X_test)
    accuracy = np.mean(np.array(Y_test).astype(np.int32)== test_pred)
    accuracy_table = accuracy_table.append(
            {'k-value': k,
             'accuracy': accuracy}, ignore_index = True)
    #print(k, ":", accuracy)
plt.scatter(accuracy_table['k-value'], accuracy_table['accuracy'], color = "red")
plt.show()
print(accuracy_table)

#최적 k = 3 (accuracy: 0.960876)
X_test2 = []
Y_test2 = []
for file in test_file_list:
    X_test2.append(xy_value(file)[0])
    Y_test2.append(xy_value(file)[1])
    
knn = KNeighborsClassifier(n_neighbors=3)
knn.fit(X_train, Y_train)
test_pred = knn.predict(X_test2)
accuracy = np.mean(np.array(Y_test2).astype(np.int32)== test_pred)
print(accuracy)
